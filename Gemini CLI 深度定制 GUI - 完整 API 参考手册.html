<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gemini CLI - GUI å®šåˆ¶ API å‚è€ƒæ‰‹å†Œ</title>
<link href='https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Bai Jamjuree', sans-serif; background: #0d1117; color: #e6edf3; line-height: 1.6; }
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }

/* Header */
.header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); border-radius: 16px; padding: 40px; margin-bottom: 30px; border: 1px solid #30363d; position: relative; overflow: hidden; }
.header::before { content: ''; position: absolute; top: -50%; right: -20%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255,105,0,0.15) 0%, transparent 70%); border-radius: 50%; }
.header h1 { font-size: 2.2em; color: #FF6900; margin-bottom: 10px; position: relative; }
.header p { color: #8b949e; font-size: 1.1em; position: relative; }
.badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.75em; font-weight: 600; margin: 4px; }
.badge-core { background: rgba(255,105,0,0.2); color: #FF6900; border: 1px solid rgba(255,105,0,0.3); }
.badge-tool { background: rgba(36,162,217,0.2); color: #24A2D9; border: 1px solid rgba(36,162,217,0.3); }
.badge-event { background: rgba(139,92,246,0.2); color: #a78bfa; border: 1px solid rgba(139,92,246,0.3); }
.badge-hook { background: rgba(16,185,129,0.2); color: #34d399; border: 1px solid rgba(16,185,129,0.3); }
.badge-config { background: rgba(251,191,36,0.2); color: #fbbf24; border: 1px solid rgba(251,191,36,0.3); }

/* Navigation */
.nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 30px; padding: 16px; background: #161b22; border-radius: 12px; border: 1px solid #30363d; }
.nav a { color: #8b949e; text-decoration: none; padding: 8px 16px; border-radius: 8px; font-size: 0.9em; transition: all 0.2s; font-weight: 500; }
.nav a:hover { background: rgba(255,105,0,0.15); color: #FF6900; }

/* Sections */
.section { background: #161b22; border: 1px solid #30363d; border-radius: 12px; margin-bottom: 24px; overflow: hidden; }
.section-header { padding: 20px 24px; background: linear-gradient(90deg, rgba(255,105,0,0.08) 0%, transparent 100%); border-bottom: 1px solid #30363d; display: flex; align-items: center; gap: 12px; }
.section-header h2 { color: #e6edf3; font-size: 1.3em; }
.section-icon { font-size: 1.4em; }
.section-body { padding: 24px; }

/* API Cards */
.api-card { background: #0d1117; border: 1px solid #21262d; border-radius: 10px; margin-bottom: 16px; overflow: hidden; transition: border-color 0.2s; }
.api-card:hover { border-color: #FF6900; }
.api-card-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #21262d; }
.api-name { font-family: 'Courier New', monospace; font-size: 1em; color: #FF6900; font-weight: 600; }
.api-card-body { padding: 16px 20px; }
.api-desc { color: #8b949e; margin-bottom: 12px; font-size: 0.9em; }

/* Code blocks */
pre { background: #0d1117; border: 1px solid #21262d; border-radius: 8px; padding: 16px; overflow-x: auto; margin: 10px 0; }
code { font-family: 'Courier New', monospace; font-size: 0.85em; color: #e6edf3; }
.keyword { color: #ff7b72; }
.string { color: #a5d6ff; }
.type { color: #d2a8ff; }
.comment { color: #8b949e; }
.func { color: #d2a8ff; }
.param { color: #ffa657; }

/* Tables */
table { width: 100%; border-collapse: collapse; margin: 12px 0; }
th { background: #21262d; color: #e6edf3; padding: 10px 14px; text-align: left; font-size: 0.85em; font-weight: 600; }
td { padding: 10px 14px; border-bottom: 1px solid #21262d; font-size: 0.85em; color: #c9d1d9; }
tr:hover td { background: rgba(255,105,0,0.03); }

/* Architecture Diagram */
.arch-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin: 16px 0; }
.arch-item { background: #0d1117; border: 1px solid #21262d; border-radius: 10px; padding: 20px; text-align: center; }
.arch-item h4 { color: #FF6900; margin-bottom: 8px; }
.arch-item p { color: #8b949e; font-size: 0.85em; }
.arch-arrow { text-align: center; font-size: 1.5em; color: #30363d; padding: 8px; }

/* Subsection */
.subsection { margin-top: 20px; padding-top: 16px; border-top: 1px solid #21262d; }
.subsection h3 { color: #c9d1d9; margin-bottom: 12px; font-size: 1.05em; }
.note { background: rgba(255,105,0,0.08); border-left: 3px solid #FF6900; padding: 12px 16px; border-radius: 0 8px 8px 0; margin: 12px 0; font-size: 0.9em; color: #c9d1d9; }
.warning { background: rgba(251,191,36,0.08); border-left: 3px solid #fbbf24; padding: 12px 16px; border-radius: 0 8px 8px 0; margin: 12px 0; font-size: 0.9em; color: #c9d1d9; }
.tip { background: rgba(16,185,129,0.08); border-left: 3px solid #34d399; padding: 12px 16px; border-radius: 0 8px 8px 0; margin: 12px 0; font-size: 0.9em; color: #c9d1d9; }

ul { padding-left: 20px; margin: 8px 0; }
li { margin: 4px 0; color: #c9d1d9; font-size: 0.9em; }
.tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: 600; margin-left: 8px; }
.tag-async { background: rgba(36,162,217,0.2); color: #24A2D9; }
.tag-generator { background: rgba(139,92,246,0.2); color: #a78bfa; }
.tag-class { background: rgba(255,105,0,0.2); color: #FF6900; }
.tag-interface { background: rgba(16,185,129,0.2); color: #34d399; }
.tag-enum { background: rgba(251,191,36,0.2); color: #fbbf24; }
</style>
</head>
<body>
<div class="container">

<!-- Header -->
<div class="header">
  <h1>ğŸ”§ Gemini CLI - GUI æ·±åº¦å®šåˆ¶ API å®Œæ•´å‚è€ƒ</h1>
  <p>åŸºäº <code>@google/gemini-cli-core </code> v0.30.0 æºç åˆ†æ Â· æå–å…¨éƒ¨å¯ç¼–ç¨‹æ¥å£ï¼š 

</p>
  <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid #30363d;">
    <div style="flex: 1; min-width: 250px;">
      <h4 style="color: #FF6900; font-size: 0.9em; margin-bottom: 10px;">ğŸ“¦ æ ¸å¿ƒåŒ…ä¿¡æ¯</h4>
      <table style="margin: 0; font-size: 0.85em;">
        <tr><td style="border:none; padding: 4px 0;">NPM</td><td style="border:none; padding: 4px 0;"><a href="https://www.npmjs.com/package/@google/gemini-cli-core" style="color: #24A2D9; text-decoration: none;">@google/gemini-cli-core</a></td></tr>
        <tr><td style="border:none; padding: 4px 0;">GitHub</td><td style="border:none; padding: 4px 0;"><a href="https://github.com/google-gemini/gemini-cli/tree/main/packages/core" style="color: #24A2D9; text-decoration: none;">https://github.com/google-gemini/gemini-cli/tree/main/packages/core</a></td></tr>
        <tr><td style="border:none; padding: 4px 0;">Latest</td><td style="border:none; padding: 4px 0;"><span class="tag tag-interface">0.28.0</span></td></tr>
        <tr><td style="border:none; padding: 4px 0;">Nightly</td><td style="border:none; padding: 4px 0;"><span class="tag tag-class">0.30.0</span></td></tr>
      </table>
    </div>
    <div style="flex: 1.5; min-width: 300px;">
      <h4 style="color: #FF6900; font-size: 0.9em; margin-bottom: 10px;">ğŸš€ å®‰è£…å‘½ä»¤</h4>
      <pre style="margin: 0; padding: 12px; background: #0d1117; border: 1px solid #21262d;"><code style="font-size: 0.85em;"><span class="comment"># ç¨³å®šç‰ˆ</span>
npm install @google/gemini-cli-core
<span class="comment"># é¢„è§ˆç‰ˆ / Nightly</span>
npm install @google/gemini-cli-core@nightly</code></pre>
      <div class="tip" style="margin-top: 10px; padding: 8px 12px; font-size: 0.8em;">
        ğŸ’¡ å®˜æ–¹æŒç»­å‘å¸ƒï¼Œæ”¯æŒç›´æ¥ <code>import</code> ä½¿ç”¨ï¼Œæ— éœ€å…‹éš† Monorepoã€‚
      </div>
    </div>
  </div>

  <div style="margin-top:16px">
    <span class="badge badge-core">Core æ ¸å¿ƒ</span>
    <span class="badge badge-tool">Tools å·¥å…·</span>
    <span class="badge badge-event">Events äº‹ä»¶</span>
    <span class="badge badge-hook">Hooks é’©å­</span>
    <span class="badge badge-config">Config é…ç½®</span>
  </div>
</div>

<!-- Navigation -->
<div class="nav">
  <a href='#arch'>ğŸ—ï¸ æ¶æ„æ€»è§ˆ</a>
  <a href='#entry'>ğŸ“¦ å…¥å£æ¨¡å—</a>
  <a href='#config'>âš™ï¸ Config é…ç½®</a>
  <a href='#content-gen'>ğŸ§  ContentGenerator</a>
  <a href='#gemini-chat'>ğŸ’¬ GeminiChat</a>
  <a href='#turn'>ğŸ”„ Turn/äº‹ä»¶æµ</a>
  <a href='#stream-output'>ğŸ“¤ è¾“å‡ºæ ¼å¼</a>
  <a href='#tools'>ğŸ› ï¸ å†…ç½®å·¥å…·</a>
  <a href='#tool-registry'>ğŸ“‹ ToolRegistry</a>
  <a href='#scheduler'>â±ï¸ Scheduler</a>
  <a href='#message-bus'>ğŸ“¨ MessageBus</a>
  <a href='#events'>ğŸ“¡ CoreEvents</a>
  <a href='#hooks'>ğŸª Hooks</a>
  <a href='#mcp'>ğŸ”Œ MCP åè®®</a>
  <a href='#services'>ğŸ—‚ï¸ Services</a>
  <a href='#auth'>ğŸ” è®¤è¯</a>
  <a href='#agents'>ğŸ¤– Agents</a>
  <a href='#headless'>ğŸ–¥ï¸ Headless æ¨¡å¼</a>
  <a href='#gui-guide'>ğŸ¨ GUI å®šåˆ¶æŒ‡å—</a>
</div>

<!-- 1. Architecture -->
<div class="section" id="arch">
  <div class="section-header"><span class="section-icon">ğŸ—ï¸</span><h2>æ¶æ„æ€»è§ˆ - Monorepo åŒ…ç»“æ„</h2></div>
  <div class="section-body">
    <div class="arch-box">
      <div class="arch-item">
        <h4>@google/gemini-cli</h4>
        <p>CLI å…¥å£ + Ink (React) TUI æ¸²æŸ“å±‚<br>ä¾èµ– core åŒ…</p>
      </div>
      <div class="arch-item">
        <h4>@google/gemini-cli-core â­</h4>
        <p><b>æ ¸å¿ƒåº“ - GUI å®šåˆ¶çš„ä¸»è¦ç›®æ ‡</b><br>æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€å·¥å…·ã€äº‹ä»¶ã€é…ç½®</p>
      </div>
      <div class="arch-item">
        <h4>a2a-server</h4>
        <p>Agent-to-Agent åè®®æœåŠ¡å™¨</p>
      </div>
      <div class="arch-item">
        <h4>vscode-ide-companion</h4>
        <p>VS Code IDE é›†æˆä¼´ä¾£</p>
      </div>
    </div>
    <div class="note">ğŸ’¡ <b>GUI å®šåˆ¶æ ¸å¿ƒç­–ç•¥</b>: æ›¿æ¢ <code>packages/cli</code> çš„ Ink TUI å±‚ï¼Œç›´æ¥å¼•ç”¨ <code>@google/gemini-cli-core</code> æä¾›çš„æ‰€æœ‰ APIï¼Œæ„å»ºè‡ªå·±çš„å‰ç«¯ï¼ˆElectron / Web / Tauriï¼‰ã€‚</div>
    <div class="warning">âš ï¸ <b>å…³é”®ä¾èµ–</b>: Core åŸºäº <code>@google/genai</code> SDKï¼Œè®¤è¯æ”¯æŒ OAuthã€API Keyã€Vertex AI ä¸‰ç§æ¨¡å¼ã€‚</div>
  </div>
</div>

<!-- 2. Entry / Exports -->
<div class="section" id="entry">
  <div class="section-header"><span class="section-icon">ğŸ“¦</span><h2>Core åŒ…å®Œæ•´å¯¼å‡ºæ¸…å• (index.ts)</h2></div>
  <div class="section-body">
    <p class="api-desc">ä»¥ä¸‹æ˜¯ <code>packages/core/src/index.ts</code> çš„å…¨éƒ¨ export åˆ†ç±»ï¼Œå‡å¯é€šè¿‡ <code>import { ... } from '@google/gemini-cli-core'</code> å¼•ç”¨ï¼š</p>
    <table>
      <tr><th>åˆ†ç±»</th><th>æ¨¡å—è·¯å¾„</th><th>åŒ…å«å†…å®¹</th></tr>
      <tr><td><span class="badge badge-config">Config</span></td><td>config/config, config/memory, config/models, config/constants, config/storage</td><td>Config ç±», ConfigParameters, HierarchicalMemory, æ¨¡å‹å¸¸é‡, Storage</td></tr>
      <tr><td><span class="badge badge-core">Core</span></td><td>core/client, core/contentGenerator, core/geminiChat, core/turn, core/prompts, core/tokenLimits, core/geminiRequest, core/coreToolScheduler</td><td>GeminiClient, ContentGenerator, GeminiChat, Turn, GeminiEventType</td></tr>
      <tr><td><span class="badge badge-tool">Tools</span></td><td>tools/tools, tools/tool-registry, tools/tool-names, tools/read-file, tools/ls, tools/grep, tools/glob, tools/edit, tools/write-file, tools/shell, tools/web-fetch, tools/web-search, tools/memoryTool, tools/read-many-files, tools/mcp-tool, tools/write-todos</td><td>å…¨éƒ¨å†…ç½®å·¥å…·å®šä¹‰ + ToolRegistry + ToolBuilder æ¥å£</td></tr>
      <tr><td><span class="badge badge-event">Events</span></td><td>utils/events</td><td>CoreEvent æšä¸¾, CoreEventEmitter, æ‰€æœ‰ Payload ç±»å‹</td></tr>
      <tr><td><span class="badge badge-hook">Hooks</span></td><td>hooks/index, hooks/types</td><td>HookSystem, HookEventName, HookDefinition, HookOutput</td></tr>
      <tr><td><span class="badge badge-core">Scheduler</span></td><td>scheduler/scheduler, scheduler/types, scheduler/tool-executor</td><td>ToolCall çŠ¶æ€æœº, ToolCallRequestInfo, ToolCallResponseInfo</td></tr>
      <tr><td><span class="badge badge-core">Services</span></td><td>services/fileDiscoveryService, services/gitService, services/chatRecordingService, services/fileSystemService, services/contextManager, services/shellExecutionService</td><td>æ–‡ä»¶å‘ç°ã€Gitã€ä¼šè¯å½•åˆ¶ã€ä¸Šä¸‹æ–‡ç®¡ç†ç­‰</td></tr>
      <tr><td><span class="badge badge-core">MessageBus</span></td><td>confirmation-bus/message-bus, confirmation-bus/types</td><td>MessageBus, ToolConfirmation è¯·æ±‚/å“åº”</td></tr>
      <tr><td><span class="badge badge-core">Output</span></td><td>output/types, output/json-formatter, output/stream-json-formatter</td><td>OutputFormat, JsonStreamEvent, JsonOutput</td></tr>
      <tr><td><span class="badge badge-core">Policy</span></td><td>policy/types, policy/policy-engine, policy/config</td><td>PolicyEngine, ApprovalMode, PolicyDecision</td></tr>
      <tr><td><span class="badge badge-core">Auth</span></td><td>code_assist/oauth2, code_assist/setup, code_assist/types, code_assist/telemetry</td><td>OAuth2 æµç¨‹, Code Assist é›†æˆ, ç”¨æˆ·å±‚çº§</td></tr>
      <tr><td><span class="badge badge-core">MCP</span></td><td>tools/mcp-client, mcp/oauth-provider, mcp/oauth-token-storage</td><td>MCP å®¢æˆ·ç«¯, OAuth Provider, Token å­˜å‚¨</td></tr>
      <tr><td><span class="badge badge-core">Agents</span></td><td>agents/types, agents/agentLoader, agents/local-executor</td><td>AgentDefinition, AgentLoader, SubagentTool</td></tr>
      <tr><td><span class="badge badge-core">Utilities</span></td><td>utils/fetch, utils/paths, utils/headless, utils/errors, utils/gitUtils, utils/checkpointUtils, utils/events, utils/browser ç­‰ 30+ æ¨¡å—</td><td>å·¥å…·å‡½æ•°é›†åˆ</td></tr>
    </table>
  </div>
</div>

<!-- 3. Config -->
<div class="section" id="config">
  <div class="section-header"><span class="section-icon">âš™ï¸</span><h2>Config ç±» - å…¨å±€é…ç½®ä¸­å¿ƒ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">new Config(params: ConfigParameters)</span>
        <span class="tag tag-class">Class</span>
      </div>
      <div class="api-card-body">
        <p class="api-desc">å…¨å±€é…ç½®å¯¹è±¡ï¼Œå‡ ä¹æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½ä¾èµ–äºå®ƒã€‚GUI åˆå§‹åŒ–æ—¶å¿…é¡»æ„é€ æ­¤å¯¹è±¡ã€‚</p>
        <h4 style="color:#FF6900;margin:12px 0 8px">ConfigParameters å…³é”®å‚æ•°ï¼š</h4>
        <table>
          <tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr>
          <tr><td><code>sessionId</code></td><td>string</td><td>ä¼šè¯å”¯ä¸€æ ‡è¯†</td></tr>
          <tr><td><code>model</code></td><td>string</td><td>æ¨¡å‹åç§° (å¦‚ gemini-2.5-pro, gemini-2.5-flash)</td></tr>
          <tr><td><code>targetDir</code></td><td>string</td><td>ç›®æ ‡é¡¹ç›®ç›®å½•</td></tr>
          <tr><td><code>cwd</code></td><td>string</td><td>å½“å‰å·¥ä½œç›®å½•</td></tr>
          <tr><td><code>debugMode</code></td><td>boolean</td><td>è°ƒè¯•æ¨¡å¼</td></tr>
          <tr><td><code>approvalMode</code></td><td>ApprovalMode</td><td>å·¥å…·å®¡æ‰¹æ¨¡å¼ (AUTO/CONFIRM/YOLO)</td></tr>
          <tr><td><code>mcpServers</code></td><td>Record&lt;string, MCPServerConfig&gt;</td><td>MCP æœåŠ¡å™¨é…ç½®æ˜ å°„</td></tr>
          <tr><td><code>interactive</code></td><td>boolean</td><td>æ˜¯å¦äº¤äº’æ¨¡å¼</td></tr>
          <tr><td><code>question</code></td><td>string?</td><td>Headless æ¨¡å¼ä¸‹çš„åˆå§‹é—®é¢˜</td></tr>
          <tr><td><code>checkpointing</code></td><td>boolean</td><td>å¯ç”¨æ£€æŸ¥ç‚¹ä¿å­˜</td></tr>
          <tr><td><code>includeDirectories</code></td><td>string[]</td><td>é¢å¤–åŒ…å«çš„ç›®å½•</td></tr>
          <tr><td><code>output</code></td><td>OutputSettings</td><td>è¾“å‡ºæ ¼å¼ (TEXT/JSON/STREAM_JSON)</td></tr>
          <tr><td><code>maxSessionTurns</code></td><td>number</td><td>æœ€å¤§ä¼šè¯è½®æ¬¡</td></tr>
          <tr><td><code>enableHooks</code></td><td>boolean</td><td>å¯ç”¨ Hook ç³»ç»Ÿ</td></tr>
          <tr><td><code>hooks</code></td><td>HookDefinition[]</td><td>ç”¨æˆ·çº§ Hook å®šä¹‰</td></tr>
          <tr><td><code>enableAgents</code></td><td>boolean</td><td>å¯ç”¨ Agent å­ç³»ç»Ÿ</td></tr>
          <tr><td><code>agents</code></td><td>AgentSettings</td><td>Agent è¦†ç›–é…ç½®</td></tr>
          <tr><td><code>policyEngineConfig</code></td><td>PolicyEngineConfig</td><td>ç­–ç•¥å¼•æ“é…ç½®</td></tr>
          <tr><td><code>plan</code></td><td>boolean</td><td>Plan æ¨¡å¼</td></tr>
          <tr><td><code>shellExecutionConfig</code></td><td>ShellExecutionConfig</td><td>Shell æ‰§è¡Œé…ç½®</td></tr>
          <tr><td><code>proxy</code></td><td>string?</td><td>ä»£ç†æœåŠ¡å™¨</td></tr>
          <tr><td><code>accessibility</code></td><td>AccessibilitySettings</td><td>æ— éšœç¢è®¾ç½®</td></tr>
          <tr><td><code>telemetry</code></td><td>TelemetrySettings</td><td>é¥æµ‹è®¾ç½®</td></tr>
          <tr><td><code>contextFileName</code></td><td>string | string[]</td><td>ä¸Šä¸‹æ–‡æ–‡ä»¶å (é»˜è®¤ GEMINI.md)</td></tr>
          <tr><td><code>eventEmitter</code></td><td>EventEmitter</td><td>å¤–éƒ¨äº‹ä»¶å‘å°„å™¨</td></tr>
          <tr><td><code>toolOutputMasking</code></td><td>ToolOutputMaskingConfig</td><td>å·¥å…·è¾“å‡ºæ©ç é…ç½®</td></tr>
        </table>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">Config æ ¸å¿ƒ Getter æ–¹æ³•</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="comment">// æ¨¡å‹ç›¸å…³</span>
config.<span class="func">getModel</span>(): <span class="type">string</span>
config.<span class="func">getActiveModel</span>(): <span class="type">string</span>
config.<span class="func">setModel</span>(model: <span class="type">string</span>): <span class="type">void</span>

<span class="comment">// å·¥å…·æ³¨å†Œè¡¨</span>
config.<span class="func">getToolRegistry</span>(): <span class="type">ToolRegistry</span>
config.<span class="func">getContentGenerator</span>(): <span class="type">ContentGenerator</span>
config.<span class="func">getGeminiClient</span>(): <span class="type">GeminiClient</span>

<span class="comment">// æœåŠ¡</span>
config.<span class="func">getFileDiscoveryService</span>(): <span class="type">FileDiscoveryService</span>
config.<span class="func">getGitService</span>(): <span class="type">GitService</span>
config.<span class="func">getContextManager</span>(): <span class="type">ContextManager</span>

<span class="comment">// è·¯å¾„ä¸ç¯å¢ƒ</span>
config.<span class="func">getProjectRoot</span>(): <span class="type">string</span>
config.<span class="func">getSessionId</span>(): <span class="type">string</span>
config.<span class="func">getProxy</span>(): <span class="type">string | undefined</span>
config.<span class="func">getCwd</span>(): <span class="type">string</span>

<span class="comment">// ç­–ç•¥ä¸å®¡æ‰¹</span>
config.<span class="func">getPolicyEngine</span>(): <span class="type">PolicyEngine</span>
config.<span class="func">getMessageBus</span>(): <span class="type">MessageBus</span>
config.<span class="func">getHookSystem</span>(): <span class="type">HookSystem</span>
config.<span class="func">getApprovalMode</span>(): <span class="type">ApprovalMode</span></code></pre>
      </div>
    </div>

    <div class="subsection">
      <h3>ApprovalMode æšä¸¾</h3>
      <pre><code><span class="keyword">enum</span> <span class="type">ApprovalMode</span> {
  <span class="param">ALWAYS_CONFIRM</span>,   <span class="comment">// æ‰€æœ‰å·¥å…·è°ƒç”¨éƒ½éœ€ç¡®è®¤</span>
  <span class="param">AUTO_APPROVE</span>,     <span class="comment">// è‡ªåŠ¨æ‰¹å‡†ï¼ˆåŸºäºç­–ç•¥ï¼‰</span>
  <span class="param">YOLO</span>              <span class="comment">// å…¨è‡ªåŠ¨ï¼Œä¸ç¡®è®¤</span>
}</code></pre>
    </div>

    <div class="subsection">
      <h3>CustomTheme - è‡ªå®šä¹‰ä¸»é¢˜ (GUI ç›´æ¥å¯ç”¨)</h3>
      <pre><code><span class="keyword">interface</span> <span class="type">CustomTheme</span> {
  type: <span class="string">'custom'</span>;
  name: <span class="type">string</span>;
  text?: { primary?, secondary?, link?, accent?, response? };
  background?: { primary?, diff?: { added?, removed? } };
  border?: { default?, focused? };
  ui?: { comment?, symbol?, gradient?: <span class="type">string[]</span> };
  status?: { error?, success?, warning? };
}</code></pre>
    </div>
  </div>
</div>

<!-- 4. ContentGenerator -->
<div class="section" id="content-gen">
  <div class="section-header"><span class="section-icon">ğŸ§ </span><h2>ContentGenerator - å†…å®¹ç”Ÿæˆæ¥å£</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">interface ContentGenerator</span>
        <span class="tag tag-interface">Interface</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">ContentGenerator</span> {
  <span class="func">generateContent</span>(
    request: <span class="type">GenerateContentParameters</span>,
    userPromptId: <span class="type">string</span>
  ): <span class="type">Promise&lt;GenerateContentResponse&gt;</span>;

  <span class="func">generateContentStream</span>(
    request: <span class="type">GenerateContentParameters</span>,
    userPromptId: <span class="type">string</span>
  ): <span class="type">Promise&lt;AsyncGenerator&lt;GenerateContentResponse&gt;&gt;</span>;

  <span class="func">countTokens</span>(
    request: <span class="type">CountTokensParameters</span>
  ): <span class="type">Promise&lt;CountTokensResponse&gt;</span>;

  <span class="func">embedContent</span>(
    request: <span class="type">EmbedContentParameters</span>
  ): <span class="type">Promise&lt;EmbedContentResponse&gt;</span>;

  userTier?: <span class="type">UserTierId</span>;
  userTierName?: <span class="type">string</span>;
}</code></pre>
        <p class="api-desc">é€šè¿‡ <code>createContentGenerator()</code> å·¥å‚å‡½æ•°åˆ›å»ºï¼Œæ”¯æŒ OAuth / API Key / Vertex AI ä¸‰ç§è®¤è¯ã€‚</p>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">AuthType æšä¸¾</span>
        <span class="tag tag-enum">Enum</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">enum</span> <span class="type">AuthType</span> {
  LOGIN_WITH_GOOGLE = <span class="string">'oauth-personal'</span>,
  USE_GEMINI        = <span class="string">'gemini-api-key'</span>,
  USE_VERTEX_AI     = <span class="string">'vertex-ai'</span>,
  LEGACY_CLOUD_SHELL= <span class="string">'cloud-shell'</span>,
  COMPUTE_ADC       = <span class="string">'compute-default-credentials'</span>,
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 5. GeminiChat -->
<div class="section" id="gemini-chat">
  <div class="section-header"><span class="section-icon">ğŸ’¬</span><h2>GeminiChat - ä¼šè¯ç®¡ç†æ ¸å¿ƒ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">class GeminiChat</span>
        <span class="tag tag-class">Class</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">class</span> <span class="type">GeminiChat</span> {
  <span class="keyword">constructor</span>(
    config: <span class="type">Config</span>,
    systemInstruction: <span class="type">string</span>,
    tools: <span class="type">Tool[]</span>,
    history: <span class="type">Content[]</span>,
    resumedSessionData?: <span class="type">ResumedSessionData</span>,
    onModelChanged?: (modelId: <span class="type">string</span>) => <span class="type">Promise&lt;Tool[]&gt;</span>
  )

  <span class="comment">// æ ¸å¿ƒæ–¹æ³•</span>
  <span class="func">setSystemInstruction</span>(sysInstr: <span class="type">string</span>): <span class="type">void</span>

  <span class="keyword">async</span> <span class="func">sendMessageStream</span>(
    modelConfigKey: <span class="type">ModelConfigKey</span>,
    message: <span class="type">PartListUnion</span>,
    prompt_id: <span class="type">string</span>,
    signal: <span class="type">AbortSignal</span>,
    displayContent?: <span class="type">PartListUnion</span>
  ): <span class="type">Promise&lt;AsyncGenerator&lt;StreamEvent&gt;&gt;</span>

  <span class="comment">// ä¸Šä¸‹æ–‡ç®¡ç†</span>
  <span class="func">getHistory</span>(): <span class="type">Content[]</span>
  <span class="func">clearHistory</span>(): <span class="type">void</span>
  <span class="func">compressHistory</span>(): <span class="type">Promise&lt;ChatCompressionInfo&gt;</span>
  <span class="func">addToolResponse</span>(completed: <span class="type">CompletedToolCall[]</span>): <span class="type">void</span>
}</code></pre>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">StreamEvent è”åˆç±»å‹</span>
        <span class="tag tag-interface">Type</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">type</span> <span class="type">StreamEvent</span> =
  | { type: <span class="string">'chunk'</span>;  value: <span class="type">GenerateContentResponse</span> }
  | { type: <span class="string">'retry'</span> }
  | { type: <span class="string">'agent_execution_stopped'</span>; reason: <span class="type">string</span> }
  | { type: <span class="string">'agent_execution_blocked'</span>; reason: <span class="type">string</span> }</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 6. Turn / Event Stream -->
<div class="section" id="turn">
  <div class="section-header"><span class="section-icon">ğŸ”„</span><h2>Turn ç±» - Agentic Loop äº‹ä»¶æµ (GUI æ¸²æŸ“æ ¸å¿ƒ)</h2></div>
  <div class="section-body">
    <div class="note">ğŸ¯ <b>è¿™æ˜¯ GUI æœ€é‡è¦çš„ API</b>ï¼šTurn.run() è¿”å›çš„ AsyncGenerator æ˜¯é©±åŠ¨æ•´ä¸ª UI æ¸²æŸ“çš„äº‹ä»¶æºã€‚</div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">Turn.run()</span>
        <span class="tag tag-async">async*</span>
        <span class="tag tag-generator">AsyncGenerator</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">async</span> *<span class="func">run</span>(
  modelConfigKey: <span class="type">ModelConfigKey</span>,
  req: <span class="type">PartListUnion</span>,
  signal: <span class="type">AbortSignal</span>,
  displayContent?: <span class="type">PartListUnion</span>
): <span class="type">AsyncGenerator&lt;ServerGeminiStreamEvent&gt;</span></code></pre>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">GeminiEventType æšä¸¾ - å…¨éƒ¨ 17 ç§äº‹ä»¶</span>
        <span class="tag tag-enum">Enum</span>
      </div>
      <div class="api-card-body">
        <table>
          <tr><th>äº‹ä»¶ç±»å‹</th><th>Value</th><th>è¯´æ˜</th><th>GUI ç”¨é€”</th></tr>
          <tr><td><code>Content</code></td><td><code>{ value: string, traceId? }</code></td><td>æ¨¡å‹æ–‡æœ¬è¾“å‡ºï¼ˆæµå¼ï¼‰</td><td>âœ… å®æ—¶æ¸²æŸ“ Markdown</td></tr>
          <tr><td><code>Thought</code></td><td><code>{ value: ThoughtSummary, traceId? }</code></td><td>æ¨¡å‹æ€è€ƒè¿‡ç¨‹</td><td>âœ… æŠ˜å æ˜¾ç¤ºæ¨ç†é“¾</td></tr>
          <tr><td><code>ToolCallRequest</code></td><td><code>{ value: ToolCallRequestInfo }</code></td><td>å·¥å…·è°ƒç”¨è¯·æ±‚</td><td>âœ… æ˜¾ç¤ºå·¥å…·è°ƒç”¨å¡ç‰‡</td></tr>
          <tr><td><code>ToolCallResponse</code></td><td><code>{ value: ToolCallResponseInfo }</code></td><td>å·¥å…·æ‰§è¡Œç»“æœ</td><td>âœ… æ˜¾ç¤ºæ‰§è¡Œç»“æœ</td></tr>
          <tr><td><code>ToolCallConfirmation</code></td><td><code>{ value: { request, details } }</code></td><td>éœ€ç”¨æˆ·ç¡®è®¤</td><td>âœ… å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†</td></tr>
          <tr><td><code>UserCancelled</code></td><td><code>{}</code></td><td>ç”¨æˆ·å–æ¶ˆ</td><td>åœæ­¢æ¸²æŸ“</td></tr>
          <tr><td><code>Error</code></td><td><code>{ value: { error: StructuredError } }</code></td><td>é”™è¯¯</td><td>âœ… æ˜¾ç¤ºé”™è¯¯æç¤º</td></tr>
          <tr><td><code>ChatCompressed</code></td><td><code>{ value: ChatCompressionInfo }</code></td><td>ä¸Šä¸‹æ–‡å‹ç¼©</td><td>é€šçŸ¥æ¡</td></tr>
          <tr><td><code>Finished</code></td><td><code>{ value: { reason, usageMetadata } }</code></td><td>å›åˆå®Œæˆ</td><td>âœ… Token ç»Ÿè®¡é¢æ¿</td></tr>
          <tr><td><code>MaxSessionTurns</code></td><td><code>{}</code></td><td>è¾¾åˆ°æœ€å¤§è½®æ¬¡</td><td>è­¦å‘Šå¼¹çª—</td></tr>
          <tr><td><code>LoopDetected</code></td><td><code>{}</code></td><td>æ£€æµ‹åˆ°å¾ªç¯</td><td>è­¦å‘Šæç¤º</td></tr>
          <tr><td><code>Citation</code></td><td><code>{ value: string }</code></td><td>å¼•ç”¨æ¥æº</td><td>âœ… å¼•ç”¨é“¾æ¥æ¸²æŸ“</td></tr>
          <tr><td><code>Retry</code></td><td><code>{}</code></td><td>æ­£åœ¨é‡è¯•</td><td>Loading çŠ¶æ€</td></tr>
          <tr><td><code>ContextWindowWillOverflow</code></td><td><code>{ estimatedRequestTokenCount, remainingTokenCount }</code></td><td>ä¸Šä¸‹æ–‡å³å°†æº¢å‡º</td><td>å®¹é‡è­¦å‘Šæ¡</td></tr>
          <tr><td><code>InvalidStream</code></td><td><code>{}</code></td><td>æ— æ•ˆæµ</td><td>é”™è¯¯å¤„ç†</td></tr>
          <tr><td><code>ModelInfo</code></td><td><code>{ value: string }</code></td><td>æ¨¡å‹ä¿¡æ¯</td><td>çŠ¶æ€æ æ›´æ–°</td></tr>
          <tr><td><code>AgentExecutionStopped</code></td><td><code>{ reason, systemMessage? }</code></td><td>Agent åœæ­¢</td><td>åœæ­¢åŠ¨ç”»</td></tr>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- 7. Output Format -->
<div class="section" id="stream-output">
  <div class="section-header"><span class="section-icon">ğŸ“¤</span><h2>è¾“å‡ºæ ¼å¼ - Headless / Stream JSON</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">JsonStreamEvent ç±»å‹ (stream-json æ¨¡å¼)</span>
        <span class="tag tag-interface">Type</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">enum</span> <span class="type">JsonStreamEventType</span> {
  INIT        = <span class="string">'init'</span>,        <span class="comment">// { session_id, model }</span>
  MESSAGE     = <span class="string">'message'</span>,     <span class="comment">// { role, content, delta? }</span>
  TOOL_USE    = <span class="string">'tool_use'</span>,    <span class="comment">// { tool_name, tool_id, parameters }</span>
  TOOL_RESULT = <span class="string">'tool_result'</span>, <span class="comment">// { tool_id, status, output?, error? }</span>
  ERROR       = <span class="string">'error'</span>,       <span class="comment">// { severity, message }</span>
  RESULT      = <span class="string">'result'</span>,      <span class="comment">// { status, stats? }</span>
}

<span class="comment">// ä½¿ç”¨: gemini -p "prompt" --output-format stream-json</span>
<span class="comment">// è¾“å‡º NDJSON (æ¯è¡Œä¸€ä¸ª JSON äº‹ä»¶)</span></code></pre>
        <div class="tip">ğŸ’¡ <b>GUI æœ€ä½³å®è·µ</b>: å¦‚æœä½ çš„ GUI é€šè¿‡å­è¿›ç¨‹è°ƒç”¨ gemini-cliï¼Œä½¿ç”¨ <code>--output-format stream-json</code> ç›´æ¥è§£æ NDJSON æµã€‚å¦‚æœç›´æ¥åµŒå…¥ core åº“ï¼Œåˆ™ä½¿ç”¨ Turn çš„ AsyncGeneratorã€‚</div>
      </div>
    </div>
  </div>
</div>

<!-- 8. Built-in Tools -->
<div class="section" id="tools">
  <div class="section-header"><span class="section-icon">ğŸ› ï¸</span><h2>å†…ç½®å·¥å…·å®Œæ•´åˆ—è¡¨</h2></div>
  <div class="section-body">
    <table>
      <tr><th>å·¥å…·å</th><th>ç±»</th><th>åŠŸèƒ½</th><th>Kind</th></tr>
      <tr><td><code>read_file</code></td><td>ReadFileTool</td><td>è¯»å–æ–‡ä»¶å†…å®¹</td><td>ReadOnly</td></tr>
      <tr><td><code>read_many_files</code></td><td>ReadManyFilesTool</td><td>æ‰¹é‡è¯»å–å¤šä¸ªæ–‡ä»¶</td><td>ReadOnly</td></tr>
      <tr><td><code>ls</code></td><td>LSTool</td><td>åˆ—å‡ºç›®å½•å†…å®¹</td><td>ReadOnly</td></tr>
      <tr><td><code>glob</code></td><td>GlobTool</td><td>æ–‡ä»¶æ¨¡å¼åŒ¹é…æœç´¢</td><td>ReadOnly</td></tr>
      <tr><td><code>grep</code> / <code>ripgrep</code></td><td>GrepTool / RipGrepTool</td><td>æ–‡ä»¶å†…å®¹æœç´¢</td><td>ReadOnly</td></tr>
      <tr><td><code>replace</code></td><td>EditTool</td><td>ç¼–è¾‘/æ›¿æ¢æ–‡ä»¶å†…å®¹ (åŸºäº diff)</td><td>Write</td></tr>
      <tr><td><code>write_file</code></td><td>WriteFileTool</td><td>åˆ›å»º/è¦†å†™æ–‡ä»¶</td><td>Write</td></tr>
      <tr><td><code>shell</code></td><td>ShellTool</td><td>æ‰§è¡Œ Shell å‘½ä»¤</td><td>Dangerous</td></tr>
      <tr><td><code>web_fetch</code></td><td>WebFetchTool</td><td>è·å–ç½‘é¡µå†…å®¹</td><td>Network</td></tr>
      <tr><td><code>google_web_search</code></td><td>WebSearchTool</td><td>Google æœç´¢</td><td>Network</td></tr>
      <tr><td><code>save_memory</code></td><td>MemoryTool</td><td>ä¿å­˜è®°å¿†åˆ° GEMINI.md</td><td>Write</td></tr>
      <tr><td><code>write_todos</code></td><td>WriteTodosTool</td><td>å†™å…¥ TODO åˆ—è¡¨</td><td>Write</td></tr>
      <tr><td><code>ask_user</code></td><td>AskUserTool</td><td>å‘ç”¨æˆ·æé—® (GUI å…³é”®)</td><td>Interactive</td></tr>
      <tr><td><code>enter_plan_mode</code></td><td>EnterPlanModeTool</td><td>è¿›å…¥è®¡åˆ’æ¨¡å¼</td><td>Other</td></tr>
      <tr><td><code>exit_plan_mode</code></td><td>ExitPlanModeTool</td><td>é€€å‡ºè®¡åˆ’æ¨¡å¼</td><td>Other</td></tr>
      <tr><td><code>activate_skill</code></td><td>ActivateSkillTool</td><td>æ¿€æ´»æŠ€èƒ½</td><td>Other</td></tr>
    </table>
  </div>
</div>

<!-- 9. ToolRegistry -->
<div class="section" id="tool-registry">
  <div class="section-header"><span class="section-icon">ğŸ“‹</span><h2>ToolRegistry - å·¥å…·æ³¨å†Œè¡¨</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">class ToolRegistry</span>
        <span class="tag tag-class">Class</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">class</span> <span class="type">ToolRegistry</span> {
  <span class="func">registerTool</span>(tool: <span class="type">AnyDeclarativeTool</span>): <span class="type">void</span>
  <span class="func">unregisterTool</span>(name: <span class="type">string</span>): <span class="type">void</span>
  <span class="func">getTool</span>(name: <span class="type">string</span>): <span class="type">AnyDeclarativeTool | undefined</span>
  <span class="func">getActiveTools</span>(): <span class="type">Map&lt;string, AnyDeclarativeTool&gt;</span>
  <span class="func">getAllTools</span>(): <span class="type">Map&lt;string, AnyDeclarativeTool&gt;</span>
  <span class="func">getToolSchemas</span>(modelId?: <span class="type">string</span>): <span class="type">FunctionDeclaration[]</span>
  <span class="func">sortTools</span>(): <span class="type">void</span>
  <span class="func">isActive</span>(name: <span class="type">string</span>): <span class="type">boolean</span>
  <span class="func">getMessageBus</span>(): <span class="type">MessageBus</span>
}</code></pre>
        <div class="tip">ğŸ’¡ <b>è‡ªå®šä¹‰å·¥å…·</b>: ç»§æ‰¿ <code>DeclarativeTool&lt;TParams, TResult&gt;</code> æˆ– <code>BaseDeclarativeTool</code> æ¥åˆ›å»ºè‡ªå®šä¹‰å·¥å…·å¹¶æ³¨å†Œåˆ° ToolRegistryã€‚</div>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">ToolBuilder / ToolInvocation æ¥å£</span>
        <span class="tag tag-interface">Interface</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">ToolBuilder</span>&lt;TParams, TResult&gt; {
  name: <span class="type">string</span>;               <span class="comment">// å†…éƒ¨åç§°</span>
  displayName: <span class="type">string</span>;        <span class="comment">// æ˜¾ç¤ºåç§° â†’ GUI ä½¿ç”¨</span>
  description: <span class="type">string</span>;        <span class="comment">// å·¥å…·æè¿°</span>
  kind: <span class="type">Kind</span>;                  <span class="comment">// ReadOnly | Write | Dangerous | Network | Other</span>
  isOutputMarkdown: <span class="type">boolean</span>;  <span class="comment">// è¾“å‡ºæ˜¯å¦ä¸º Markdown</span>
  canUpdateOutput: <span class="type">boolean</span>;   <span class="comment">// æ˜¯å¦æ”¯æŒæµå¼è¾“å‡º</span>
  <span class="func">getSchema</span>(modelId?): <span class="type">FunctionDeclaration</span>;
  <span class="func">build</span>(params): <span class="type">ToolInvocation</span>;
}

<span class="keyword">interface</span> <span class="type">ToolInvocation</span>&lt;TParams, TResult&gt; {
  params: <span class="type">TParams</span>;
  <span class="func">getDescription</span>(): <span class="type">string</span>;              <span class="comment">// â†’ GUI æ˜¾ç¤ºæ“ä½œæè¿°</span>
  <span class="func">toolLocations</span>(): <span class="type">ToolLocation[]</span>;       <span class="comment">// â†’ GUI æ˜¾ç¤ºå—å½±å“è·¯å¾„</span>
  <span class="func">shouldConfirmExecute</span>(signal): <span class="type">Promise</span>; <span class="comment">// â†’ GUI å¼¹å‡ºç¡®è®¤æ¡†</span>
  <span class="func">execute</span>(signal, updateOutput?): <span class="type">Promise&lt;TResult&gt;</span>;
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 10. Scheduler -->
<div class="section" id="scheduler">
  <div class="section-header"><span class="section-icon">â±ï¸</span><h2>Scheduler - å·¥å…·è°ƒç”¨è°ƒåº¦å™¨</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">ToolCall çŠ¶æ€æœº (GUI æ¸²æŸ“å·¥å…·è°ƒç”¨å¡ç‰‡çš„æ•°æ®æº)</span>
        <span class="tag tag-interface">Type</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">type</span> <span class="type">ToolCall</span> =
  | { status: <span class="string">'validating'</span>;       request, tool, invocation }
  | { status: <span class="string">'scheduled'</span>;        request, tool, invocation }
  | { status: <span class="string">'executing'</span>;        request, tool, invocation, liveOutput?, pid? }
  | { status: <span class="string">'awaiting_approval'</span>; request, tool, invocation, confirmationDetails }
  | { status: <span class="string">'success'</span>;          request, tool, response, invocation, durationMs? }
  | { status: <span class="string">'error'</span>;            request, response, durationMs? }
  | { status: <span class="string">'cancelled'</span>;        request, response, tool, invocation }

<span class="comment">// å…³é”®æ•°æ®ç»“æ„</span>
<span class="keyword">interface</span> <span class="type">ToolCallRequestInfo</span> {
  callId: <span class="type">string</span>;
  name: <span class="type">string</span>;
  args: <span class="type">Record&lt;string, unknown&gt;</span>;
  isClientInitiated: <span class="type">boolean</span>;
  prompt_id: <span class="type">string</span>;
  traceId?: <span class="type">string</span>;
  parentCallId?: <span class="type">string</span>;
  schedulerId?: <span class="type">string</span>;
}

<span class="keyword">interface</span> <span class="type">ToolCallResponseInfo</span> {
  callId: <span class="type">string</span>;
  responseParts: <span class="type">Part[]</span>;
  resultDisplay: <span class="type">ToolResultDisplay | undefined</span>;
  error: <span class="type">Error | undefined</span>;
  errorType: <span class="type">ToolErrorType | undefined</span>;
  contentLength?: <span class="type">number</span>;
  data?: <span class="type">Record&lt;string, unknown&gt;</span>;
}</code></pre>
      </div>
    </div>

    <div class="subsection">
      <h3>Scheduler å›è°ƒ Handlers</h3>
      <pre><code><span class="keyword">type</span> <span class="type">ConfirmHandler</span> = (toolCall: <span class="type">WaitingToolCall</span>) => <span class="type">Promise&lt;ToolConfirmationOutcome&gt;</span>
<span class="keyword">type</span> <span class="type">OutputUpdateHandler</span> = (callId: <span class="type">string</span>, chunk: <span class="type">string | AnsiOutput</span>) => <span class="type">void</span>
<span class="keyword">type</span> <span class="type">AllToolCallsCompleteHandler</span> = (completed: <span class="type">CompletedToolCall[]</span>) => <span class="type">Promise&lt;void&gt;</span>
<span class="keyword">type</span> <span class="type">ToolCallsUpdateHandler</span> = (toolCalls: <span class="type">ToolCall[]</span>) => <span class="type">void</span></code></pre>
    </div>
  </div>
</div>

<!-- 11. MessageBus -->
<div class="section" id="message-bus">
  <div class="section-header"><span class="section-icon">ğŸ“¨</span><h2>MessageBus - ç¡®è®¤/ç­–ç•¥æ¶ˆæ¯æ€»çº¿</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">MessageBusType æšä¸¾ + æ¶ˆæ¯ç±»å‹</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">enum</span> <span class="type">MessageBusType</span> {
  TOOL_CONFIRMATION_REQUEST  <span class="comment">// å·¥å…·ç¡®è®¤è¯·æ±‚ â†’ GUI å¼¹çª—</span>
  TOOL_CONFIRMATION_RESPONSE <span class="comment">// ç”¨æˆ·ç¡®è®¤å“åº” â† GUI å›ä¼ </span>
  TOOL_POLICY_REJECTION      <span class="comment">// ç­–ç•¥æ‹’ç»é€šçŸ¥</span>
  TOOL_EXECUTION_SUCCESS     <span class="comment">// å·¥å…·æ‰§è¡ŒæˆåŠŸ</span>
  TOOL_EXECUTION_FAILURE     <span class="comment">// å·¥å…·æ‰§è¡Œå¤±è´¥</span>
  UPDATE_POLICY              <span class="comment">// æ›´æ–°ç­–ç•¥ (Always Allow)</span>
  TOOL_CALLS_UPDATE          <span class="comment">// å·¥å…·è°ƒç”¨åˆ—è¡¨æ›´æ–°</span>
  ASK_USER_REQUEST           <span class="comment">// ask_user å·¥å…·è¯·æ±‚ â†’ GUI è¾“å…¥æ¡†</span>
  ASK_USER_RESPONSE          <span class="comment">// ç”¨æˆ·å›ç­” â† GUI å›ä¼ </span>
}

<span class="comment">// GUI å¿…é¡»å®ç°çš„æ¶ˆæ¯å¤„ç†</span>
messageBus.<span class="func">subscribe</span>(<span class="type">MessageBusType.TOOL_CONFIRMATION_REQUEST</span>, handler)
messageBus.<span class="func">subscribe</span>(<span class="type">MessageBusType.ASK_USER_REQUEST</span>, handler)
messageBus.<span class="func">publish</span>({ type: <span class="type">TOOL_CONFIRMATION_RESPONSE</span>, correlationId, confirmed, outcome })
messageBus.<span class="func">publish</span>({ type: <span class="type">ASK_USER_RESPONSE</span>, correlationId, answers })</code></pre>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">SerializableConfirmationDetails (ç¡®è®¤å¯¹è¯æ¡†æ•°æ®)</span>
      </div>
      <div class="api-card-body">
        <table>
          <tr><th>type</th><th>å­—æ®µ</th><th>GUI ç»„ä»¶</th></tr>
          <tr><td><code>'info'</code></td><td>title, prompt, urls?</td><td>é€šç”¨ä¿¡æ¯ç¡®è®¤æ¡†</td></tr>
          <tr><td><code>'edit'</code></td><td>title, fileName, filePath, fileDiff, originalContent, newContent</td><td>Diff é¢„è§ˆç¡®è®¤æ¡†</td></tr>
          <tr><td><code>'exec'</code></td><td>title, command, rootCommand, rootCommands, commands?</td><td>å‘½ä»¤æ‰§è¡Œç¡®è®¤æ¡†</td></tr>
          <tr><td><code>'mcp'</code></td><td>title, serverName, toolName, toolDisplayName</td><td>MCP å·¥å…·ç¡®è®¤æ¡†</td></tr>
          <tr><td><code>'ask_user'</code></td><td>title, questions[]</td><td>ç”¨æˆ·é—®ç­”é¢æ¿</td></tr>
          <tr><td><code>'exit_plan_mode'</code></td><td>title, planPath</td><td>é€€å‡ºè®¡åˆ’ç¡®è®¤</td></tr>
        </table>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">Question ç±»å‹ (ask_user å·¥å…·)</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">Question</span> {
  question: <span class="type">string</span>;
  header: <span class="type">string</span>;
  type?: <span class="string">'choice'</span> | <span class="string">'text'</span> | <span class="string">'yesno'</span>;
  options?: <span class="type">QuestionOption[]</span>;  <span class="comment">// { label, description }</span>
  multiSelect?: <span class="type">boolean</span>;
  placeholder?: <span class="type">string</span>;
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 12. CoreEvents -->
<div class="section" id="events">
  <div class="section-header"><span class="section-icon">ğŸ“¡</span><h2>CoreEvents - å…¨å±€äº‹ä»¶ç³»ç»Ÿ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">coreEvents (CoreEventEmitter å•ä¾‹)</span>
      </div>
      <div class="api-card-body">
        <table>
          <tr><th>äº‹ä»¶å</th><th>Payload</th><th>GUI ç”¨é€”</th></tr>
          <tr><td><code>user-feedback</code></td><td><code>{ severity, message, error? }</code></td><td>âœ… Toast / é€šçŸ¥</td></tr>
          <tr><td><code>model-changed</code></td><td><code>{ model }</code></td><td>âœ… çŠ¶æ€æ æ¨¡å‹å</td></tr>
          <tr><td><code>console-log</code></td><td><code>{ type, content }</code></td><td>è°ƒè¯•é¢æ¿</td></tr>
          <tr><td><code>output</code></td><td><code>{ isStderr, chunk, encoding? }</code></td><td>ç»ˆç«¯è¾“å‡ºé¢æ¿</td></tr>
          <tr><td><code>memory-changed</code></td><td><code>{ fileCount }</code></td><td>å†…å­˜æ–‡ä»¶æŒ‡ç¤ºå™¨</td></tr>
          <tr><td><code>quota-changed</code></td><td><code>{ remaining, limit, resetTime? }</code></td><td>âœ… é…é¢è¿›åº¦æ¡</td></tr>
          <tr><td><code>hook-start</code></td><td><code>{ hookName, eventName, hookIndex?, totalHooks? }</code></td><td>Hook æ‰§è¡ŒæŒ‡ç¤ºå™¨</td></tr>
          <tr><td><code>hook-end</code></td><td><code>{ hookName, eventName, success }</code></td><td>Hook å®ŒæˆçŠ¶æ€</td></tr>
          <tr><td><code>mcp-client-update</code></td><td><code>Map&lt;string, McpClient&gt;</code></td><td>âœ… MCP æœåŠ¡å™¨é¢æ¿</td></tr>
          <tr><td><code>settings-changed</code></td><td><code>void</code></td><td>åˆ·æ–°è®¾ç½® UI</td></tr>
          <tr><td><code>retry-attempt</code></td><td><code>{ attempt, maxAttempts, delayMs, error?, model }</code></td><td>é‡è¯•è¿›åº¦</td></tr>
          <tr><td><code>consent-request</code></td><td><code>{ prompt, onConfirm }</code></td><td>âœ… åŒæ„å¼¹çª—</td></tr>
          <tr><td><code>agents-discovered</code></td><td><code>{ agents: AgentDefinition[] }</code></td><td>Agent é¢æ¿</td></tr>
          <tr><td><code>agents-refreshed</code></td><td><code>void</code></td><td>åˆ·æ–° Agent åˆ—è¡¨</td></tr>
          <tr><td><code>request-editor-selection</code></td><td><code>void</code></td><td>ç¼–è¾‘å™¨é€‰æ‹©å¼¹çª—</td></tr>
          <tr><td><code>editor-selected</code></td><td><code>{ editor? }</code></td><td>ç¼–è¾‘å™¨çŠ¶æ€æ›´æ–°</td></tr>
        </table>
        <pre><code><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="keyword">import</span> { coreEvents, CoreEvent } <span class="keyword">from</span> <span class="string">'@google/gemini-cli-core'</span>;

coreEvents.<span class="func">on</span>(CoreEvent.UserFeedback, (payload) => {
  showToast(payload.severity, payload.message);
});

coreEvents.<span class="func">on</span>(CoreEvent.QuotaChanged, ({ remaining, limit }) => {
  updateQuotaBar(remaining, limit);
});

coreEvents.<span class="func">on</span>(CoreEvent.ModelChanged, ({ model }) => {
  updateStatusBar(model);
});</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 13. Hooks -->
<div class="section" id="hooks">
  <div class="section-header"><span class="section-icon">ğŸª</span><h2>Hooks ç³»ç»Ÿ - ç”Ÿå‘½å‘¨æœŸæ‹¦æˆª</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">HookEventName æšä¸¾</span>
        <span class="tag tag-enum">Enum</span>
      </div>
      <div class="api-card-body">
        <table>
          <tr><th>Hook</th><th>è§¦å‘æ—¶æœº</th><th>å¯æ‹¦æˆª?</th></tr>
          <tr><td><code>SessionStart</code></td><td>ä¼šè¯å¼€å§‹</td><td>âœ…</td></tr>
          <tr><td><code>SessionEnd</code></td><td>ä¼šè¯ç»“æŸ</td><td>-</td></tr>
          <tr><td><code>BeforeModel</code></td><td>å‘é€è¯·æ±‚ç»™æ¨¡å‹å‰</td><td>âœ… å¯ä¿®æ”¹è¯·æ±‚</td></tr>
          <tr><td><code>AfterModel</code></td><td>æ”¶åˆ°æ¨¡å‹å“åº”å</td><td>âœ… å¯ä¿®æ”¹å“åº”</td></tr>
          <tr><td><code>BeforeTool</code></td><td>æ‰§è¡Œå·¥å…·å‰</td><td>âœ… block/deny/approve</td></tr>
          <tr><td><code>AfterTool</code></td><td>å·¥å…·æ‰§è¡Œå</td><td>-</td></tr>
          <tr><td><code>BeforeAgent</code></td><td>Agent æ‰§è¡Œå‰</td><td>âœ…</td></tr>
          <tr><td><code>AfterAgent</code></td><td>Agent æ‰§è¡Œå</td><td>âœ…</td></tr>
          <tr><td><code>BeforeToolSelection</code></td><td>å·¥å…·é€‰æ‹©å‰</td><td>âœ… å¯ä¿®æ”¹å·¥å…·åˆ—è¡¨</td></tr>
          <tr><td><code>PreCompress</code></td><td>ä¸Šä¸‹æ–‡å‹ç¼©å‰</td><td>-</td></tr>
          <tr><td><code>Notification</code></td><td>é€šçŸ¥äº‹ä»¶</td><td>-</td></tr>
        </table>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">HookOutput - Hook è¿”å›å€¼</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">HookOutput</span> {
  continue?: <span class="type">boolean</span>;         <span class="comment">// false = åœæ­¢æ‰§è¡Œ</span>
  stopReason?: <span class="type">string</span>;        <span class="comment">// åœæ­¢åŸå› </span>
  suppressOutput?: <span class="type">boolean</span>;   <span class="comment">// æŠ‘åˆ¶è¾“å‡º</span>
  systemMessage?: <span class="type">string</span>;     <span class="comment">// æ³¨å…¥ç³»ç»Ÿæ¶ˆæ¯</span>
  decision?: <span class="string">'ask'</span> | <span class="string">'block'</span> | <span class="string">'deny'</span> | <span class="string">'approve'</span> | <span class="string">'allow'</span>;
  reason?: <span class="type">string</span>;
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 14. MCP -->
<div class="section" id="mcp">
  <div class="section-header"><span class="section-icon">ğŸ”Œ</span><h2>MCP (Model Context Protocol) é›†æˆ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">MCPServerConfig</span>
        <span class="tag tag-class">Class</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">class</span> <span class="type">MCPServerConfig</span> {
  <span class="comment">// stdio ä¼ è¾“</span>
  command?: <span class="type">string</span>;   args?: <span class="type">string[]</span>;   env?: <span class="type">Record&lt;string, string&gt;</span>;   cwd?: <span class="type">string</span>;
  <span class="comment">// SSE ä¼ è¾“</span>
  url?: <span class="type">string</span>;
  <span class="comment">// HTTP ä¼ è¾“</span>
  httpUrl?: <span class="type">string</span>;   headers?: <span class="type">Record&lt;string, string&gt;</span>;
  <span class="comment">// WebSocket</span>
  tcp?: <span class="type">string</span>;
  <span class="comment">// ä¼ è¾“ç±»å‹</span>
  type?: <span class="string">'sse'</span> | <span class="string">'http'</span>;
  <span class="comment">// é€šç”¨</span>
  timeout?: <span class="type">number</span>;   trust?: <span class="type">boolean</span>;   description?: <span class="type">string</span>;
  includeTools?: <span class="type">string[]</span>;   excludeTools?: <span class="type">string[]</span>;
  <span class="comment">// OAuth</span>
  oauth?: <span class="type">MCPOAuthConfig</span>;   authProviderType?: <span class="type">AuthProviderType</span>;
}</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 15. Services -->
<div class="section" id="services">
  <div class="section-header"><span class="section-icon">ğŸ—‚ï¸</span><h2>Services æœåŠ¡å±‚</h2></div>
  <div class="section-body">
    <div class="arch-box">
      <div class="arch-item">
        <h4>ChatRecordingService</h4>
        <p>ä¼šè¯å½•åˆ¶æœåŠ¡<br><code>initialize()</code> / <code>recordUserMessage()</code> / <code>recordAssistantMessage()</code> / <code>recordToolCall()</code><br>ä¿å­˜ä¸º JSON: <code>~/.gemini/tmp/&lt;hash&gt;/chats/session-*.json</code></p>
      </div>
      <div class="arch-item">
        <h4>FileDiscoveryService</h4>
        <p>é¡¹ç›®æ–‡ä»¶å‘ç°<br>æ”¯æŒ gitignoreã€geminiignoreã€æ¨¡ç³Šæœç´¢</p>
      </div>
      <div class="arch-item">
        <h4>GitService</h4>
        <p>Git æ“ä½œå°è£…<br>åŸºäº simple-git åº“</p>
      </div>
      <div class="arch-item">
        <h4>ContextManager</h4>
        <p>ä¸Šä¸‹æ–‡ç®¡ç†<br>ç®¡ç† GEMINI.mdã€å·¥ä½œåŒºä¸Šä¸‹æ–‡ã€ç¯å¢ƒä¸Šä¸‹æ–‡</p>
      </div>
      <div class="arch-item">
        <h4>ShellExecutionService</h4>
        <p>Shell å‘½ä»¤æ‰§è¡Œ<br>æ”¯æŒ PTYã€æ²™ç®±ã€è¶…æ—¶æ§åˆ¶</p>
      </div>
      <div class="arch-item">
        <h4>ModelConfigService</h4>
        <p>æ¨¡å‹é…ç½®ç®¡ç†<br>å¤šæ¨¡å‹é…ç½®é”®å€¼ã€è·¯ç”±ç­–ç•¥</p>
      </div>
    </div>

    <div class="api-card">
      <div class="api-card-header">
        <span class="api-name">ConversationRecord (ä¼šè¯è®°å½•æ•°æ®ç»“æ„)</span>
        <span class="tag tag-interface">Interface</span>
      </div>
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">ConversationRecord</span> {
  sessionId: <span class="type">string</span>;      projectHash: <span class="type">string</span>;
  startTime: <span class="type">string</span>;      lastUpdated: <span class="type">string</span>;
  messages: <span class="type">MessageRecord[]</span>;   summary?: <span class="type">string</span>;
  directories?: <span class="type">string[]</span>;
}

<span class="keyword">type</span> <span class="type">MessageRecord</span> = BaseMessageRecord & (
  | { type: <span class="string">'user'</span> | <span class="string">'info'</span> | <span class="string">'error'</span> | <span class="string">'warning'</span> }
  | { type: <span class="string">'gemini'</span>; toolCalls?: <span class="type">ToolCallRecord[]</span>; thoughts?: <span class="type">ThoughtSummary[]</span>; tokens?: <span class="type">TokensSummary</span>; model?: <span class="type">string</span> }
)</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 16. Auth -->
<div class="section" id="auth">
  <div class="section-header"><span class="section-icon">ğŸ”</span><h2>è®¤è¯ç³»ç»Ÿ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-body">
        <pre><code><span class="comment">// ä¸‰ç§è®¤è¯æµç¨‹</span>

<span class="comment">// 1. Google OAuth (å…è´¹å±‚)</span>
<span class="keyword">import</span> { createContentGenerator, AuthType } <span class="keyword">from</span> <span class="string">'@google/gemini-cli-core'</span>;
<span class="keyword">const</span> genConfig = { authType: AuthType.LOGIN_WITH_GOOGLE };

<span class="comment">// 2. Gemini API Key</span>
<span class="keyword">const</span> genConfig = { authType: AuthType.USE_GEMINI, apiKey: <span class="string">'your-key'</span> };

<span class="comment">// 3. Vertex AI</span>
<span class="keyword">const</span> genConfig = { authType: AuthType.USE_VERTEX_AI, apiKey: <span class="string">'key'</span>, vertexai: <span class="keyword">true</span> };

<span class="comment">// å·¥å‚å‡½æ•°</span>
<span class="keyword">const</span> generator = <span class="keyword">await</span> <span class="func">createContentGenerator</span>(genConfig, config);</code></pre>
        <div class="note">ğŸ’¡ ç¯å¢ƒå˜é‡: <code>GEMINI_API_KEY</code>, <code>GOOGLE_API_KEY</code>, <code>GOOGLE_CLOUD_PROJECT</code>, <code>GOOGLE_CLOUD_LOCATION</code></div>
      </div>
    </div>
  </div>
</div>

<!-- 17. Agents -->
<div class="section" id="agents">
  <div class="section-header"><span class="section-icon">ğŸ¤–</span><h2>Agents å­ä»£ç†ç³»ç»Ÿ</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-body">
        <pre><code><span class="keyword">interface</span> <span class="type">AgentDefinition</span> {
  name: <span class="type">string</span>;
  description: <span class="type">string</span>;
  systemPrompt?: <span class="type">string</span>;
  modelConfig?: <span class="type">ModelConfig</span>;
  runConfig?: <span class="type">AgentRunConfig</span>;   <span class="comment">// { maxTimeMinutes?, maxTurns? }</span>
  enabled?: <span class="type">boolean</span>;
}

<span class="comment">// Agent æ³¨å†Œä¸åŠ è½½</span>
<span class="keyword">import</span> { AgentRegistry, AgentLoader } <span class="keyword">from</span> <span class="string">'@google/gemini-cli-core'</span>;</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 18. Headless -->
<div class="section" id="headless">
  <div class="section-header"><span class="section-icon">ğŸ–¥ï¸</span><h2>Headless æ¨¡å¼ - è„šæœ¬åŒ–è°ƒç”¨</h2></div>
  <div class="section-body">
    <div class="api-card">
      <div class="api-card-body">
        <pre><code><span class="comment">// å‘½ä»¤è¡Œæ–¹å¼</span>
$ gemini -p <span class="string">"ä½ çš„é—®é¢˜"</span>                         <span class="comment">// çº¯æ–‡æœ¬è¾“å‡º</span>
$ gemini -p <span class="string">"ä½ çš„é—®é¢˜"</span> --output-format json        <span class="comment">// JSON è¾“å‡º</span>
$ gemini -p <span class="string">"ä½ çš„é—®é¢˜"</span> --output-format stream-json  <span class="comment">// NDJSON æµ</span>
$ gemini -p <span class="string">"ä½ çš„é—®é¢˜"</span> -m gemini-2.5-pro           <span class="comment">// æŒ‡å®šæ¨¡å‹</span>

<span class="comment">// ç¼–ç¨‹æ–¹å¼ (å­è¿›ç¨‹)</span>
<span class="keyword">import</span> { spawn } <span class="keyword">from</span> <span class="string">'child_process'</span>;
<span class="keyword">const</span> proc = spawn(<span class="string">'gemini'</span>, [<span class="string">'-p'</span>, prompt, <span class="string">'--output-format'</span>, <span class="string">'stream-json'</span>]);
proc.stdout.on(<span class="string">'data'</span>, (chunk) => {
  <span class="keyword">const</span> events = chunk.toString().split(<span class="string">'\n'</span>).filter(Boolean).map(JSON.parse);
  <span class="comment">// å¤„ç† JsonStreamEvent</span>
});</code></pre>
      </div>
    </div>
  </div>
</div>

<!-- 19. GUI å®šåˆ¶æŒ‡å— -->
<div class="section" id="gui-guide">
  <div class="section-header"><span class="section-icon">ğŸ¨</span><h2>GUI æ·±åº¦å®šåˆ¶å®æ–½æŒ‡å—</h2></div>
  <div class="section-body">

    <div class="subsection">
      <h3>æ–¹æ¡ˆ A: ç›´æ¥åµŒå…¥ Core åº“ (æ¨è - æœ€å¤§æ§åˆ¶åŠ›)</h3>
      <pre><code><span class="comment">// 1. å®‰è£…ä¾èµ–</span>
npm install @google/gemini-cli-core @google/genai

<span class="comment">// 2. åˆå§‹åŒ– Config</span>
<span class="keyword">const</span> config = <span class="keyword">new</span> <span class="type">Config</span>({
  sessionId: crypto.randomUUID(),
  model: <span class="string">'gemini-2.5-pro'</span>,
  targetDir: projectPath,
  cwd: projectPath,
  debugMode: <span class="keyword">false</span>,
  interactive: <span class="keyword">true</span>,
  approvalMode: ApprovalMode.ALWAYS_CONFIRM,
});
<span class="keyword">await</span> config.initialize();

<span class="comment">// 3. ç›‘å¬å…¨å±€äº‹ä»¶</span>
coreEvents.on(CoreEvent.UserFeedback, renderFeedback);
coreEvents.on(CoreEvent.QuotaChanged, updateQuota);
coreEvents.on(CoreEvent.ModelChanged, updateModel);

<span class="comment">// 4. è®¢é˜… MessageBus (å¤„ç†ç¡®è®¤å¼¹çª—)</span>
<span class="keyword">const</span> bus = config.getMessageBus();
bus.subscribe(MessageBusType.TOOL_CONFIRMATION_REQUEST, showConfirmDialog);
bus.subscribe(MessageBusType.ASK_USER_REQUEST, showQuestionPanel);

<span class="comment">// 5. åˆ›å»º GeminiChat å¹¶è¿è¡Œ Turn</span>
<span class="keyword">const</span> chat = <span class="keyword">new</span> <span class="type">GeminiChat</span>(config, systemPrompt, tools, []);
<span class="keyword">const</span> turn = <span class="keyword">new</span> <span class="type">Turn</span>(chat, promptId);
<span class="keyword">const</span> controller = <span class="keyword">new</span> AbortController();

<span class="keyword">for await</span> (<span class="keyword">const</span> event <span class="keyword">of</span> turn.run(<span class="string">'default'</span>, userMessage, controller.signal)) {
  <span class="keyword">switch</span>(event.type) {
    <span class="keyword">case</span> GeminiEventType.Content:
      appendMarkdown(event.value); <span class="keyword">break</span>;
    <span class="keyword">case</span> GeminiEventType.Thought:
      showThinking(event.value); <span class="keyword">break</span>;
    <span class="keyword">case</span> GeminiEventType.ToolCallRequest:
      showToolCard(event.value); <span class="keyword">break</span>;
    <span class="keyword">case</span> GeminiEventType.ToolCallResponse:
      updateToolResult(event.value); <span class="keyword">break</span>;
    <span class="keyword">case</span> GeminiEventType.Finished:
      showTokenStats(event.value.usageMetadata); <span class="keyword">break</span>;
    <span class="keyword">case</span> GeminiEventType.Error:
      showError(event.value.error); <span class="keyword">break</span>;
  }
}</code></pre>
    </div>

    <div class="subsection">
      <h3>æ–¹æ¡ˆ B: å­è¿›ç¨‹ + Stream JSON (è½»é‡é›†æˆ)</h3>
      <pre><code><span class="comment">// é€‚åˆ Electron ç­‰åœºæ™¯ï¼Œé€šè¿‡ stream-json ä¸ CLI é€šä¿¡</span>
<span class="keyword">const</span> proc = spawn(<span class="string">'gemini'</span>, [
  <span class="string">'-p'</span>, userInput,
  <span class="string">'--output-format'</span>, <span class="string">'stream-json'</span>,
  <span class="string">'-m'</span>, <span class="string">'gemini-2.5-pro'</span>
]);

<span class="comment">// è§£æ NDJSON æµ</span>
proc.stdout.on(<span class="string">'data'</span>, (chunk) => {
  chunk.toString().split(<span class="string">'\n'</span>).filter(Boolean).forEach(line => {
    <span class="keyword">const</span> event: <span class="type">JsonStreamEvent</span> = JSON.parse(line);
    <span class="keyword">switch</span>(event.type) {
      <span class="keyword">case</span> <span class="string">'init'</span>:       onSessionStart(event); <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'message'</span>:    onMessage(event); <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'tool_use'</span>:   onToolUse(event); <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'tool_result'</span>: onToolResult(event); <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'error'</span>:      onError(event); <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'result'</span>:     onComplete(event); <span class="keyword">break</span>;
    }
  });
});</code></pre>
    </div>

    <div class="subsection">
      <h3>GUI ç»„ä»¶æ˜ å°„è¡¨</h3>
      <table>
        <tr><th>GUI ç»„ä»¶</th><th>æ•°æ®æº API</th><th>è¯´æ˜</th></tr>
        <tr><td>ğŸ—¨ï¸ èŠå¤©æ°”æ³¡</td><td><code>GeminiEventType.Content</code></td><td>æµå¼ Markdown æ¸²æŸ“</td></tr>
        <tr><td>ğŸ§  æ€è€ƒè¿‡ç¨‹æŠ˜å </td><td><code>GeminiEventType.Thought</code></td><td>ThoughtSummary.text</td></tr>
        <tr><td>ğŸ”§ å·¥å…·è°ƒç”¨å¡ç‰‡</td><td><code>ToolCall çŠ¶æ€æœº</code></td><td>7 ç§çŠ¶æ€å®æ—¶æ›´æ–°</td></tr>
        <tr><td>âœ… ç¡®è®¤å¯¹è¯æ¡†</td><td><code>MessageBus.TOOL_CONFIRMATION_REQUEST</code></td><td>6 ç§ confirmation ç±»å‹</td></tr>
        <tr><td>ğŸ“ Diff é¢„è§ˆ</td><td><code>SerializableConfirmationDetails.edit</code></td><td>fileDiff / originalContent / newContent</td></tr>
        <tr><td>â“ ç”¨æˆ·é—®ç­”é¢æ¿</td><td><code>MessageBus.ASK_USER_REQUEST</code></td><td>choice / text / yesno</td></tr>
        <tr><td>ğŸ“Š Token ç»Ÿè®¡</td><td><code>GeminiFinishedEventValue.usageMetadata</code></td><td>input/output/cached tokens</td></tr>
        <tr><td>ğŸ“ˆ é…é¢ç›‘æ§</td><td><code>CoreEvent.QuotaChanged</code></td><td>remaining / limit / resetTime</td></tr>
        <tr><td>ğŸ”Œ MCP æœåŠ¡å™¨é¢æ¿</td><td><code>CoreEvent.McpClientUpdate</code></td><td>Map&lt;string, McpClient&gt;</td></tr>
        <tr><td>âš™ï¸ æ¨¡å‹åˆ‡æ¢å™¨</td><td><code>config.setModel() + CoreEvent.ModelChanged</code></td><td>å®æ—¶åˆ‡æ¢</td></tr>
        <tr><td>ğŸ“‚ æ–‡ä»¶æµè§ˆå™¨</td><td><code>FileDiscoveryService</code></td><td>é¡¹ç›®æ–‡ä»¶æ ‘</td></tr>
        <tr><td>ğŸ” æœç´¢é¢æ¿</td><td><code>GrepTool / GlobTool</code></td><td>æ–‡ä»¶å†…å®¹æœç´¢</td></tr>
        <tr><td>ğŸ–¥ï¸ å†…åµŒç»ˆç«¯</td><td><code>ShellTool + ShellExecutionService</code></td><td>Shell è¾“å‡ºæµ</td></tr>
        <tr><td>ğŸ“œ ä¼šè¯å†å²</td><td><code>ChatRecordingService / ConversationRecord</code></td><td>JSON æ–‡ä»¶ + æ¢å¤</td></tr>
        <tr><td>ğŸ¨ ä¸»é¢˜è®¾ç½®</td><td><code>CustomTheme æ¥å£</code></td><td>å®Œæ•´é¢œè‰²å®šåˆ¶</td></tr>
        <tr><td>ğŸ¤– Agent é¢æ¿</td><td><code>AgentRegistry + CoreEvent.AgentsDiscovered</code></td><td>å­ä»£ç†ç®¡ç†</td></tr>
        <tr><td>ğŸª Hooks ç®¡ç†</td><td><code>HookSystem + HookEventName</code></td><td>11 ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­</td></tr>
        <tr><td>ğŸ›¡ï¸ ç­–ç•¥ç®¡ç†</td><td><code>PolicyEngine + ApprovalMode</code></td><td>å·¥å…·æƒé™æ§åˆ¶</td></tr>
      </table>
    </div>

    <div class="tip">âœ… <b>å®Œæ•´æ€§è¯´æ˜</b>: æœ¬æ–‡æ¡£è¦†ç›–äº† Gemini CLI Core çš„å…¨éƒ¨å…¬å¼€ APIï¼ŒåŒ…å« 17 ç§äº‹ä»¶ç±»å‹ã€16+ å†…ç½®å·¥å…·ã€11 ä¸ª Hook ç‚¹ã€8 ç§ MessageBus æ¶ˆæ¯ã€3 ç§è®¤è¯æ–¹å¼ã€3 ç§è¾“å‡ºæ ¼å¼ã€‚æ‰€æœ‰ç±»å‹å‡å¯ä» <code>@google/gemini-cli-core</code> ç›´æ¥ importã€‚</div>
  </div>
</div>

</div>
</body>
</html>
